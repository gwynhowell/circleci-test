dependencies:
  pre:
    # download gae sdk ...
    - curl -o $HOME/google_appengine_1.9.40.zip https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.40.zip
    - unzip -q -d $HOME $HOME/google_appengine_1.9.40.zip
    # retrieve service account creds ...
    - echo $CLIENT_SECRET | base64 --decode > ${HOME}/client-secret.json
    # update gcloud ...
    - gcloud --quiet components update app
    # authenticate gcloud ...
    - gcloud auth activate-service-account --key-file ${HOME}/client-secret.json
    # set project ...
    - gcloud config set project $GCLOUD_PROJECT
  post:
    - ln -s $VIRTUAL_ENV src/local
    
machine:
  environment:
    PYTHONPATH: ${PYTHONPATH}:${HOME}/google_appengine
    GCLOUD_PROJECT: "gwyns-stash"